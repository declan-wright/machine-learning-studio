<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLP Training Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Chivo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <main>
        <h1>Machine Learning Studio</h1>
        <p id="subheading">Train Multilayer Perceptrons Easily Using Your Own Data</p>

        <button id="darkModeToggle" onclick="toggleDarkMode()">
            Toggle Dark Mode
        </button>

        <div class="app-container">
            <!-- Data Management Section -->
            <div id="dataManagement" class="section-card">
                <h2><i class="fas fa-database"></i> Data Management</h2>
                
                <div class="upload-section">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3>Upload Your Dataset</h3>
                        <p>Drag and drop your CSV file here, or click to browse</p>
                        <input type="file" id="dataFile" accept=".csv" hidden>
                        <button class="upload-button" onclick="document.getElementById('dataFile').click()">
                            Choose CSV File
                        </button>
                    </div>
                </div>
                
                <div id="dataInfo" class="data-info" style="display: none;">
                    <h3>Dataset Information</h3>
                    <div id="dataDetails" class="data-details"></div>
                </div>
            </div>

            <!-- Model Configuration Section -->
            <div id="modelConfig" class="section-card">
                <h2><i class="fas fa-cog"></i> Model Configuration</h2>
                
                <form id="trainingForm" class="config-form">
                    <div class="form-group">
                        <label for="targetColumn">Target Column:</label>
                        <select id="targetColumn" required>
                            <option value="">Select target column...</option>
                        </select>
                    </div>

                    <div id="recommendationsSection" class="recommendations-section" style="display: none;">
                        <button type="button" id="applyRecommendations" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-magic"></i> Apply Recommendations
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="hiddenLayers">Hidden Layers:</label>
                        <input type="text" id="hiddenLayers" value="100,50" placeholder="e.g., 100,50,25">
                        <small>Comma-separated layer sizes</small>
                        <div id="hiddenLayersRec" class="recommendation-hint" style="display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label for="activation">Activation Function:</label>
                        <select id="activation">
                            <option value="swiglu">SwiGLU (13.4x overhead) - Recommended</option>
                            <option value="gelu">GELU (24.0x overhead)</option>
                            <option value="leaky_relu">Leaky ReLU (5.9x overhead)</option>
                            <option value="relu" selected>ReLU (1.0x overhead)</option>
                            <option value="tanh">Tanh (16.0x overhead)</option>
                        </select>
                        <div id="activationRec" class="recommendation-hint" style="display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label for="solver">Solver:</label>
                        <select id="solver">
                            <option value="adam" selected>Adam</option>
                            <option value="adamw">AdamW</option>
                            <option value="lbfgs">L-BFGS</option>
                            <option value="sgd">SGD</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="learningRate">Learning Rate:</label>
                        <input type="number" id="learningRate" value="0.0001" step="0.000001" min="0.000001" max="1">
                        <div id="learningRateRec" class="recommendation-hint" style="display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label for="maxIter">Max Iterations (Epochs):</label>
                        <input type="number" id="maxIter" value="3000" min="20" max="10000">
                        <div id="epochsRec" class="recommendation-hint" style="display: none;"></div>
                    </div>

                    <div class="form-group">
                        <label for="useLearningRateScheduler">
                            <input type="checkbox" id="useLearningRateScheduler"> 
                            Use Learning Rate Scheduler
                        </label>
                        <small>Automatically reduce learning rate during training</small>
                    </div>

                    <div class="form-group">
                        <label for="testSize">Test Size:</label>
                        <input type="number" id="testSize" value="0.2" step="0.05" min="0.1" max="0.5">
                    </div>

                    <div id="smoteSection" class="form-group" style="display: none;">
                        <label for="useSmote">
                            <input type="checkbox" id="useSmote"> 
                            Use SMOTE for Class Balancing
                        </label>
                        <div id="smoteRec" class="recommendation-hint" style="display: none;"></div>
                    </div>

                    <div id="smoteOptions" class="smote-options" style="display: none;">
                        <div class="form-group">
                            <label for="smoteStrategy">SMOTE Strategy:</label>
                            <select id="smoteStrategy">
                                <option value="auto" selected>Auto</option>
                                <option value="minority">Minority</option>
                                <option value="not majority">Not Majority</option>
                                <option value="not minority">Not Minority</option>
                                <option value="all">All</option>
                            </select>
                            <small>Which classes to resample</small>
                        </div>

                        <div class="form-group">
                            <label for="smoteKNeighbors">K Neighbors:</label>
                            <input type="number" id="smoteKNeighbors" value="5" min="1" max="20">
                            <small>Number of nearest neighbors for SMOTE</small>
                        </div>
                    </div>

                    <button type="submit" class="train-button">
                        <i class="fas fa-play"></i>Train Model
                    </button>
                </form>
            </div>

            <!-- Training Results Section -->
            <div id="trainingResults" class="section-card">
                <div class="section-header">
                    <h2><i class="fas fa-chart-line"></i> Training Results</h2>
                    <button class="clear-button" onclick="clearResults()">
                        <i class="fas fa-trash"></i>Clear
                    </button>
                </div>
                
                <div class="loading-overlay" id="loadingSpinner" style="display: none;">
                    <div class="loading-content">
                        <div class="loading-text show">Training Neural Network</div>
                        <div class="progress-indicator">
                            <div class="progress-bar"></div>
                        </div>
                        <div class="loading-text">Please wait while the model is being trained</div>
                    </div>
                </div>
                
                <div id="resultsContainer" style="display: none;">
                    <div class="results-grid">
                        <div class="metrics-card">
                            <h3>Performance Metrics</h3>
                            <div id="metricsDisplay" class="metrics-display"></div>
                        </div>
                        
                        <div class="config-card">
                            <h3>Model Configuration</h3>
                            <div id="configDisplay" class="config-display"></div>
                            <button class="download-button" onclick="downloadWeights()">
                                <i class="fas fa-download"></i>Download Model Weights
                            </button>
                            <small>Includes JSON, SafeTensors, and Config files</small>
                        </div>
                    </div>
                    
                    <div class="plots-grid">
                        <div class="plot-card">
                            <h3>Training History</h3>
                            <div class="plot-container">
                                <img id="trainingPlot" alt="Training History Plot">
                            </div>
                        </div>
                        
                        <div class="plot-card">
                            <h3>Predictions</h3>
                            <div class="plot-container">
                                <img id="predictionsPlot" alt="Predictions Plot">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="noResults" class="no-results">
                    <i class="fas fa-chart-line"></i>
                    <p>No training results yet. Upload data and train a model to see results here.</p>
                </div>
            </div>

            <!-- Training History Section -->
            <div id="trainingHistory" class="section-card">
                <h2><i class="fas fa-history"></i> Training History</h2>
                
                <div id="historyContainer" class="history-container">
                    <div class="no-history">
                        <i class="fas fa-history"></i>
                        <p>No training history yet.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer id="bottomSection">
        <p class="footer-info">
            Copyright 2025, by Declan Wright
        </p>
    </footer>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // Dark mode toggle functionality
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
        }
    </script>
</body>
</html> 